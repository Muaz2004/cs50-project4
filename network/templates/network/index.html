{% extends "network/layout.html" %}
{% block body %}

<!-- New Post Card -->
<div class="max-w-3xl mx-auto mb-8">
    {% if user.is_authenticated %}
    <div class="bg-white dark:bg-[#1E293B] p-6 rounded-xl shadow-md border border-gray-200 dark:border-gray-700 transition-colors duration-300">
        <h2 class="text-xl font-semibold text-gray-800 dark:text-gray-200 mb-3">Create a New Post</h2>
        <p class="text-gray-600 dark:text-gray-400 mb-4 text-sm">Share your thoughts, ideas, or updates with the community.</p>
        <form action="{% url 'newpost' %}" method="post" class="flex flex-col gap-3">
            {% csrf_token %}
            <textarea name="content" placeholder="What's on your mind?" 
                      class="border border-gray-300 dark:border-gray-600 rounded-md p-3 w-full focus:outline-none focus:ring-2 focus:ring-[#0EA5E9] dark:bg-[#0F172A] dark:text-gray-100 transition-colors duration-300"></textarea>
            <div class="flex justify-end">
                <button type="submit" 
                        class="bg-[#0EA5E9] text-white px-5 py-2 rounded-md font-medium hover:bg-[#0284C7] transition-colors duration-200 shadow-sm">
                    Post
                </button>
            </div>
        </form>
    </div>
    {% endif %}
</div>

<!-- Informational Message -->
<div class="max-w-3xl mx-auto mb-6 text-center">
    <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-200">Community Feed</h3>
    <p class="text-gray-600 dark:text-gray-400 text-sm mt-1">
        Discover the latest posts and see what everyone is talking about.
    </p>
</div>

<!-- Posts -->
<div class="flex flex-col gap-5 max-w-3xl mx-auto">
    {% for i in query %}
    <div class="bg-white dark:bg-[#1E293B] p-5 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 transition-colors duration-300">
        <div class="flex justify-between items-start mb-1">
            <a href="{% url 'profile' i.creator.id %}" class="font-semibold text-[#0EA5E9] hover:underline">{{ i.creator.username }}</a>
            <small class="text-gray-500 dark:text-gray-400">{{ i.timestamp }}</small>
        </div>
        <p class="mt-2 text-gray-800 dark:text-gray-200 leading-relaxed">{{ i.newpost }}</p>

        <!-- Like button -->
        <div class="mt-3 flex items-center">
            <button 
                class="like-button text-2xl focus:outline-none transition-colors duration-200"
                data-post-id="{{ i.id }}"
                {% if user in i.liked_by.all %}
                    style="color:red;"
                {% else %}
                    style="color:white;"
                {% endif %}>
                {% if user in i.liked_by.all %}
                    ‚ù§Ô∏è
                {% else %}
                    ü§ç
                {% endif %}
            </button>
            <span class="ml-2 text-sm text-gray-600 dark:text-gray-400" id="likes-count-{{ i.id }}">{{ i.likes }}</span>
        </div>
    </div>
    {% empty %}
    <p class="text-center text-gray-500 dark:text-gray-400">No posts yet. Be the first to share something!</p>
    {% endfor %}
</div>

<!-- Pagination -->
<div class="mt-6 flex justify-center max-w-3xl mx-auto">
    <nav>
        <ul class="flex gap-1">
            {% if query.has_previous %}
                <li>
                    <a href="?page={{ query.previous_page_number }}" class="px-3 py-1 rounded-md bg-[#0EA5E9] text-white hover:bg-[#0284C7]">Prev</a>
                </li>
            {% endif %}

            {% for page_num in query.paginator.page_range %}
                {% if query.number == page_num %}
                    <li>
                        <span class="px-3 py-1 rounded-md bg-gray-300 dark:bg-gray-600">{{ page_num }}</span>
                    </li>
                {% else %}
                    <li>
                        <a href="?page={{ page_num }}" class="px-3 py-1 rounded-md hover:bg-gray-200 dark:hover:bg-gray-700">{{ page_num }}</a>
                    </li>
                {% endif %}
            {% endfor %}

            {% if query.has_next %}
                <li>
                    <a href="?page={{ query.next_page_number }}" class="px-3 py-1 rounded-md bg-[#0EA5E9] text-white hover:bg-[#0284C7]">Next</a>
                </li>
            {% endif %}
        </ul>
    </nav>
</div>

<!-- Like Button Script -->
<script>
document.querySelectorAll('.like-button').forEach(button => {
    button.addEventListener('click', async () => {
        const postId = button.dataset.postId;
        const response = await fetch(`/like/${postId}/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': '{{ csrf_token }}',
                'Content-Type': 'application/json',
            },
        });
        const data = await response.json();

        if (data.liked) {
            button.textContent = '‚ù§Ô∏è';
            button.style.color = 'red';
        } else {
            button.textContent = 'ü§ç';
            button.style.color = 'white';
        }
        document.getElementById(`likes-count-${postId}`).textContent = data.likes;
    });
});
</script>

{% endblock %}
